define(["jquery","jquery-ui","i18n!fx-olap/nls/pivot"],function(a,b,c){function d(a){var b=Object.prototype.toString.call(a),c=Array.prototype.map||function(a){for(var b=[],c=0;c<this.length;c++)b.push(a(this[c]));return b};if("[object Object]"===b){var e=[];for(var f in a)a.hasOwnProperty(f)&&e.push([f,d(a[f])]);return e.sort(function(a,b){return a[0]<b[0]?-1:1}),e=c.call(e,function(a){return"format"!=a[0]&&"push"!=a[0]&&"value"!=a[0]?'"'+a[0].replace(/"/g,'\\"')+'":'+a[1]:'"'+a[0].replace(/"/g,'\\"')+'":""'}),"{"+e+"}"}return"[object Array]"===b?"["+c.call(a,function(a){return d(a)})+"]":JSON.stringify(a)}var a,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},t=([].slice,function(a,b){return function(){return a.apply(b,arguments)}}),u={}.hasOwnProperty;r={grouped:!0,originalOpts:{}},j={en2:{localeStrings:c},en:{localeStrings:c}},k=c.months,h=c.days,p=function(a){return("0"+a).substr(-2,2)},i={bin:function(a,b){return function(c){return c[a]-c[a]%b}},dateFormat:function(a,b,c,d){return null==c&&(c=k),null==d&&(d=h),function(e){var f;return f=new Date(Date.parse(e[a])),isNaN(f)?"":b.replace(/%(.)/g,function(a,b){switch(b){case"y":return f.getFullYear();case"m":return p(f.getMonth()+1);case"n":return c[f.getMonth()];case"d":return p(f.getDate());case"w":return d[f.getDay()];case"x":return f.getDay();case"H":return p(f.getHours());case"M":return p(f.getMinutes());case"S":return p(f.getSeconds());default:return"%"+b}})}}},l=function(){return function(a,b){var c,d,e,f,g,h,i;if(h=/(\d+)|(\D+)/g,g=/\d/,i=/^0/,"number"==typeof a||"number"==typeof b)return isNaN(a)?1:isNaN(b)?-1:a-b;if(c=String(a).toLowerCase(),e=String(b).toLowerCase(),c===e)return 0;if(!g.test(c)||!g.test(e))return c>e?1:-1;for(c=c.match(h),e=e.match(h);c.length&&e.length;)if(d=c.shift(),f=e.shift(),d!==f)return g.test(d)&&g.test(f)?d.replace(i,".0")-f.replace(i,".0"):d>f?1:-1;return c.length-e.length}}(this),a.pivotUtilities={aggregatorTemplates:f,aggregators:g,renderers:o,derivers:i,locales:j,naturalSort:l,numberFormat:m},e=function(){function b(a,c){this.getAggregator=t(this.getAggregator,this),this.getRowKeys=t(this.getRowKeys,this),this.getColKeys=t(this.getColKeys,this),this.sortKeys=t(this.sortKeys,this),this.arrSort=t(this.arrSort,this),this.natSort=t(this.natSort,this),this.aggregator=c.aggregator,this.aggregatorName=c.aggregatorName,this.colAttrs=c.cols,this.rowAttrs=c.rows,this.valAttrs=c.vals,this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator(this,[],[]),this.sorted=!1,b.forEachRecord(a,c.derivedAttributes,function(a){return function(b){return c.filter(b)?a.processRecord(b):void 0}}(this))}return b.forEachRecord=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;if(e=a.isEmptyObject(c)?d:function(a){var b,e,f;for(b in c)e=c[b],a[b]=null!=(f=e(a))?f:a[b];return d(a)},a.isFunction(b))return b(e);if(a.isArray(b)){if(a.isArray(b[0])){o=[];for(g in b)if(u.call(b,g)&&(f=b[g],g>0)){j={},n=b[0];for(h in n)u.call(n,h)&&(i=n[h],j[i]=f[h]);o.push(e(j))}return o}for(p=[],l=0,m=b.length;m>l;l++)j=b[l],p.push(e(j));return p}if(b instanceof jQuery)return k=[],a("thead > tr > th",b).each(function(){return k.push(a(this).text())}),a("tbody > tr",b).each(function(){return j={},a("td",this).each(function(b){return j[k[b]]=a(this).text()}),e(j)});throw new Error("unknown input format")},b.convertToArray=function(a){var c;return c=[],b.forEachRecord(a,{},function(a){return c.push(a)}),c},b.prototype.natSort=function(a,b){return l(a,b)},b.prototype.arrSort=function(a,b){return this.natSort(a.join(),b.join())},b.prototype.sortKeys=function(){return this.sorted||(this.rowKeys.sort(this.arrSort),this.colKeys.sort(this.arrSort)),this.sorted=!0},b.prototype.getColKeys=function(){return this.sortKeys(),this.colKeys},b.prototype.getRowKeys=function(){return this.sortKeys(),this.rowKeys},b.prototype.processRecord=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(b=[],e=[],k=this.colAttrs,g=0,i=k.length;i>g;g++)f=k[g],b.push(null!=(l=a[f])?l:"null");for(m=this.rowAttrs,h=0,j=m.length;j>h;h++)f=m[h],e.push(null!=(n=a[f])?n:"null");return d=e.join("||"),c=b.join("||"),this.allTotal.push(a),0!==e.length&&(this.rowTotals[d]||(this.rowKeys.push(e),this.rowTotals[d]=this.aggregator(this,e,[])),this.rowTotals[d].push(a)),0!==b.length&&(this.colTotals[c]||(this.colKeys.push(b),this.colTotals[c]=this.aggregator(this,[],b)),this.colTotals[c].push(a)),0!==b.length&&0!==e.length?(this.tree[d]||(this.tree[d]={}),this.tree[d][c]||(this.tree[d][c]=this.aggregator(this,e,b)),this.tree[d][c].push(a)):void 0},b.prototype.getAggregator=function(a,b){var c,d,e;return e=a.join("||"),d=b.join("||"),c=0===a.length&&0===b.length?this.allTotal:0===a.length?this.colTotals[d]:0===b.length?this.rowTotals[e]:this.tree[e][d],null!=c?c:{value:function(){return null},format:function(){return""}}},b}(),a.fn.pivot=function(b,c){var d,f,g,h=c.rendererOptions.id;d={cols:[],rows:[],filter:function(){return!0},renderer:n,rendererOptions:null,localeStrings:j.en.localeStrings},c=a.extend({},d,c),f=null,r2=new e(b,c),f=c.renderer(new e(b,c),c.rendererOptions),g=this[0];try{for(;g.hasChildNodes();)g.removeChild(g.lastChild)}catch(i){}a("#"+h).data("internalData",r2),a("#"+h+"_fx-olap-ui_fx-olap-holder-div").html(f),a.isFunction(c.onDataLoaded)&&"undefined"==typeof this.onDataLoadedExecuted&&(c.onDataLoaded(),this.onDataLoadedExecuted=!0)};var v=function(){a("#"+this.myinputOpts.id+" .tooff").off()},w=function(){this.myinputOpts.grouped=!this.myinputOpts.grouped,a("#"+this.myinputOpts.id+"_fx-olap-ui").pivotUI(this.originalData,this.myinputOpts,!0)},x=function(){for(var b=a("#"+this.myinputOpts.id).data().internalData,c=[],e=0;e<b.rowAttrs.length;e++)c.push(b.rowAttrs[e]+"Name");flatColKeyst=[],tt=b.getColKeys();for(tti in tt)flatColKeyst.push(tt[tti].join("||"));document.getElementById("myJson").value=d({data:b.tree,header:flatColKeyst,cols:c,swUnit:this.myinputOpts.showUnit?"1":"0",swFlag:this.myinputOpts.showFlags?"1":"0"}),document.getElementById("xlsDataForm").submit()},y=function(a){this.myinputOpts.showCode=a,this.myinputOpts.originalOpts.showCode=a,this.render(this.InternalID,this.originalData,this.myinputOpts.originalOpts,!0)},z=function(a){this.myinputOpts.showUnit=a,this.myinputOpts.originalOpts.showUnit=a,this.render(this.InternalID,this.originalData,this.myinputOpts.originalOpts,!0)},A=function(a){this.myinputOpts.showFlags=a,this.myinputOpts.originalOpts.showFlags=a,this.render(this.InternalID,this.originalData,this.myinputOpts.originalOpts,!0)},B=function(){var b=new Date,c=new RegExp("<span class=ordre>[0-9]+</span>","g"),d=new RegExp("<span class=ordre></span>","g"),e=new RegExp('<table class="innerCol"><th>([0-9]+)</th><th>([^>]*)</th></table>',"g"),f=a("#"+this.myinputOpts.id).data().internalData,g=f.tree;flatColKeyst=[],tt=f.getColKeys();for(tti in tt)flatColKeyst.push(tt[tti].join("||"));for(var h=flatColKeyst.sort(),i="",j=0;j<f.rowKeys[0].length;j++)i+='"'+f.rowAttrs[j].replace("_","")+'",';for(var j in h)i+='"'+h[j].replace(/,/g,"").replace(/\|\|/g,"-").replace(/&nbsp;/g,"").replace(e,"$1").replace(c,"").replace(d,"")+'"',this.myinputOpts.showUnit&&(i+=",unit"),this.myinputOpts.showFlags&&(i+=",flag"),i+=",";i+="\n";for(var k in g){for(var l=k.split("||"),m=0;m<l.length;m++)i+='"'+l[m].replace(/,/g,"").replace(e,'$1","$2').replace(c,"").replace(d,"")+'",';for(j in h)try{g[k][h[j]]?(i+='"'+g[k][h[j]].value()[0]+'",',this.myinputOpts.showUnit&&(i+='"'+g[k][h[j]].value()[1]+'",'),this.myinputOpts.showFlags&&(i+='"'+g[k][h[j]].value()[2]+'",')):(i+=",",this.myinputOpts.showUnit&&(i+=","),this.myinputOpts.showFlags&&(i+=","))}catch(n){console.log("er",n)}i+="\n"}try{var o=document.getElementById("hor-minimalist-b").getElementsByTagName("td");for(j=0,k=0;k<o.length;k++)0==j?(i+="\n",j=1):(i+=",",j=0),i+=o[k].innerHTML}catch(p){console.log("WS getFlag not available")}i+="\n\n "+this.myinputOpts.csvText+","+b.getFullYear()+", Date : "+b.toLocaleDateString()+"\n";var q=document.createElement("a");if(void 0!==q.download){var r=new Blob(["\ufeff",i],{type:"text/csv;charset=UTF-8;"}),s=URL.createObjectURL(r);q.setAttribute("href",s),q.setAttribute("download","fileName.csv"),q.style="visibility:hidden"}else navigator.msSaveBlob?q.addEventListener("click",function(){var a=new Blob(["\ufeff",i],{type:"text/csv;charset=UTF-8;"});navigator.msSaveBlob(a,"fileName.csv")},!1):(document.getElementById("csvData").value=i,document.getElementById("csvDataForm").submit());document.body.appendChild(q),q.click(),document.body.removeChild(q)},C=function(b,c,d,e,f){this.InternalID=b,this.myinputOpts.originalOpts=d,this.myinputOpts=a.extend({},this.myinputOpts,d),this.myinputOpts.id=b,this.originalData=c;for(var g=[],h=[],i=0;i<this.myinputOpts.rows.length;i++)Array.isArray(d.rows[i])?1==this.myinputOpts.showCode?(g.push(this.myinputOpts.rows[i][0]),g.push(this.myinputOpts.rows[i][1])):(g.push(this.myinputOpts.rows[i][0]),this.myinputOpts.hiddenAttributes.push(this.myinputOpts.rows[i][1])):g.push(this.myinputOpts.rows[i]);this.myinputOpts.rows=g;for(var i=0;i<this.myinputOpts.cols.length;i++)Array.isArray(this.myinputOpts.cols[i])?d.showCode?(h.push(this.myinputOpts.cols[i][0]),h.push(this.myinputOpts.cols[i][1])):(h.push(this.myinputOpts.cols[i][0]),this.myinputOpts.hiddenAttributes.push(this.myinputOpts.rows[i][1])):h.push(this.myinputOpts.cols[i]);return this.myinputOpts.cols=h,document.getElementById(b).innerHTML="<div id='"+b+"_fx-olap-ui'></div><div id='"+b+"_fx-olap-ui_fx-olap-holder-div' style='overflow:auto'></div><div id='"+b+"_fx-olap-ui_myGrid1_div' ></div><div id='"+b+"_fx-olap-ui_fx-olap-graph-div'></div><div id='"+b+"_fx-olap-ui_mesFlags' style='clear:both'></div>",ret=a("#"+b+"_fx-olap-ui").pivotUI(c,this.myinputOpts,e,f),ret};return a.fn.pivotUI=function(b,d,f,g){var h,i,k,m,n,o,p,q,r,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X;if(null==f&&(f=!1),null==g&&(g="en"),X=d.id,p={derivedAttributes:{},renderers:{},aggregators:{},hiddenAttributes:[],menuLimit:500,cols:[],rows:[],vals:[],exclusions:{},unusedAttrsVertical:!1,autoSortUnusedAttrs:!1,rendererOptions:{localeStrings:j[g].localeStrings,id:d.id,grouped:d.grouped,showFlags:d.showFlags,showUnit:d.showUnit,showCode:d.showCode},onRefresh:null,filter:function(){return!0},localeStrings:j[g].localeStrings},null==d.InstanceRenderers)p.renderers=d.rendererDisplay;else for(r=0;r<d.InstanceRenderers.length;r++)p.renderers[d.InstanceRenderers[r].label]=d.rendererDisplay[d.InstanceRenderers[r].func];if(null==d.InstanceAggregators)p.aggregators=d.aggregatorDisplay;else for(r=0;r<d.InstanceAggregators.length;r++)p.aggregators[d.InstanceAggregators[r].label]=d.aggregatorDisplay[d.InstanceAggregators[r].func];q=this.data("pivotUIOptions"),w=null==q||f?a.extend({},p,d):q,b=e.convertToArray(b),D=function(){var a,c;a=b[0],c=[];for(v in a)u.call(a,v)&&c.push(v);return c}(),S=w.derivedAttributes;for(n in S)u.call(S,n)&&s.call(D,n)<0&&D.push(n);for(m={},K=0,O=D.length;O>K;K++)I=D[K],m[I]={};e.forEachRecord(b,w.derivedAttributes,function(a){var b,c,d;d=[];for(v in a)u.call(a,v)&&(b=a[v],w.filter(a)&&(null==b&&(b="null"),null==(c=m[v])[b]&&(c[b]=0),d.push(m[v][b]++)));return d}),G=a("<table cellpadding='5'>"),B=a("<td id='"+d.id+"_vals'>"),A=a("<select id='"+d.id+"_renderer' class='pvtRenderer tooff'>").appendTo(B).on("change",function(){return y()}),1!=d.showRender&&A.addClass("invi"),T=w.renderers;for(I in T)u.call(T,I)&&a("<option>").val(I).html(I).appendTo(A);if(o=a("<td id='"+d.id+"_unused' class='pvtAxisContainer '>"),o.addClass(1==d.showAgg?"pvtUnused":"pvtUnusedInvi"),C=function(){var a,b,c;for(c=[],a=0,b=D.length;b>a;a++)n=D[a],c.push(n);return c}(),H=!1,"auto"===w.unusedAttrsVertical){for(k=0,L=0,P=C.length;P>L;L++)h=C[L],k+=h.length;H=k>120}o.addClass(w.unusedAttrsVertical===!0||H?"pvtVertList":"pvtHorizList"),J=function(b){var d,e,f,g,h,i,j,k,n,p,q,t,u,x,z;if(j=function(){var a;a=[];for(v in m[b])a.push(v);return a}(),i=!1,t=a("<div>").addClass("pvtFilterBox").hide(),t.append(a("<h4>").text(""+b+" ("+j.length+")")),j.length>w.menuLimit)t.append(a("<p>").html(c.tooMany));else for(e=a("<p>").appendTo(t),e.append(a('<button class="tooff">').html(c.selectAll).on("click",function(){return t.find("input:visible").prop("checked",!0)})),e.append(a('<button  class="tooff">').html(c.selectNone).on("click",function(){return t.find("input:visible").prop("checked",!1)})),e.append(a('<input class="tooff">').addClass("pvtSearch").attr("placeholder",w.localeStrings.filterResults).on("keyup",function(){var b;return b=a(this).val().toLowerCase(),a(this).parents(".pvtFilterBox").find("label >span").each(function(){var c;return c=a(this).text().toLowerCase().indexOf(b),-1!==c?a(this).parent().show():a(this).parent().hide()})})),f=a("<div>").addClass("pvtCheckContainer").appendTo(t),z=j.sort(l),u=0,x=z.length;x>u;u++)v=z[u],q=m[b][v],g=a("<label class='pvtFilterLabel'>"),h=w.exclusions[b]?s.call(w.exclusions[b],v)>=0:!1,i||(i=h),a("<input type='checkbox' class='pvtFilter'>").attr("checked",!h).data("filter",[b,v]).appendTo(g),g.append(a("<span>").html(""+v+" ("+q+")")),f.append(a("<p>").append(g));return p=function(){var b;return b=a(t).find("[type='checkbox']").length-a(t).find("[type='checkbox']:checked").length,b>0?d.addClass("pvtFilteredAttribute"):d.removeClass("pvtFilteredAttribute"),j.length>w.menuLimit?t.toggle():t.toggle(0,y)},a("<p>").appendTo(t).append(a('<button class="tooff">').text("ok").on("click",p)),k=function(){return t.css({left:300,top:0}).toggle(),a(".pvtSearch").val(""),a("label").show()},n=a("<span class='pvtTriangle tooff'>").html(" &#x25BE;").on("click",k),d=s.call(w.hiddenAttributes,b)<0?a("<li class='axis_"+r+" tooff' id='"+X+"_filtre_"+b+"'>").append(a("<span class='pvtAttr'>").html(b).data("attrName",b).append(n)):a("<li class='axis_"+r+" invi' id='"+X+"_filtre_"+b+"'>").append(a("<span class='pvtAttr'>").html(b).data("attrName",b).append(n)),i&&d.addClass("pvtFilteredAttribute"),o.append(d),d.append(t),d.on("dblclick",k)};for(r in C)n=C[r],J(n);E=a("<tr>").appendTo(G),i=a("<select  id='"+X+"_aggregator' class='pvtAggregator tooff'>").on("change",function(){return y()}),1!=d.showAgg&&i.addClass("invi"),U=w.aggregators;for(I in U)u.call(U,I)&&i.append(a("<option>").val(I).html(I));for(a("<td id='"+X+"_cols' class='pvtAxisContainer pvtHorizList pvtCols'>").appendTo(E),a("<td class='pvtVals'>").appendTo(G).append(i).append(a("<br>")),F=a("<tr>").appendTo(G),a("#"+X+"_fx-olap-holder-div").empty(),x=a("<td valign='top' id='"+X+"_pvtRendererArea' class='pvtRendererArea'>").append("<div  id='"+X+"_pivot_table'>").appendTo(a("#"+X+"_fx-olap-holder-div")),w.unusedAttrsVertical===!0||H?(G.find("tr:nth-child(1)").prepend(o),G.find("tr:nth-child(2)").prepend(B)):(G.prepend(a("<tr>").append(a("<td id='"+X+"_rows' valign='top' class='pvtAxisContainer pvtRows pvtHorizList'>"))),G.prepend(a("<tr>").append(o)),G.prepend(a("<tr>").append(B))),this.html(G),V=w.cols,M=0,Q=V.length;Q>M;M++)I=V[M],this.find(".pvtCols").append(this.find(".axis_"+C.indexOf(I)));for(W=w.rows,N=0,R=W.length;R>N;N++)I=W[N],this.find(".pvtRows").append(this.find(".axis_"+C.indexOf(I)));return null!=w.aggregatorName&&this.find(".pvtAggregator").val(w.aggregatorName),null!=w.rendererName&&this.find(".pvtRenderer").val(w.rendererName),t=!0,z=function(c){return function(){var d,e,f,g,h,j,k,l,m,n,o,p,q,u;if(l={derivedAttributes:w.derivedAttributes,localeStrings:w.localeStrings,rendererOptions:w.rendererOptions,cols:[],rows:[],onDataLoaded:w.onDataLoaded},console.log(w,l),h=null!=(u=w.aggregators[i.val()]([])().numInputs)?u:0,n=[],c.find(".pvtRows li span.pvtAttr").each(function(){return l.rows.push(a(this).data("attrName"))}),c.find(".pvtCols li span.pvtAttr").each(function(){return l.cols.push(a(this).data("attrName"))}),c.find(".pvtVals select.pvtAttrDropdown").each(function(){return 0===h?a(this).remove():(h--,""!==a(this).val()?n.push(a(this).val()):void 0)}),0!==h)for(k=c.find(".pvtVals"),I=p=0;h>=0?h>p:p>h;I=h>=0?++p:--p){for(g=a("<select class='pvtAttrDropdown invi tooff'>").append(a("<option>")).on("change",function(){return y()}),q=0,o=C.length;o>q;q++)d=C[q],g.append(a("<option>").val(d).html(d));k.append(g)}return t&&(n=w.vals,r=0,c.find(".pvtVals select.pvtAttrDropdown").each(function(){return a(this).val(n[r]),r++}),t=!1),l.aggregatorName=i.val(),l.vals=n,l.aggregator=w.aggregators[i.val()](n),l.renderer=w.renderers[A.val()],e={},c.find("input.pvtFilter").not(":checked").each(function(){var b;return b=a(this).data("filter"),null!=e[b[0]]?e[b[0]].push(b[1]):e[b[0]]=[b[1]]}),l.filter=function(a){var b,c;if(!w.filter(a))return!1;for(v in e)if(b=e[v],c=""+a[v],s.call(b,c)>=0)return!1;return!0},x.pivot(b,l),j=a.extend(w,{cols:l.cols,rows:l.rows,vals:n,exclusions:e,aggregatorName:i.val(),rendererName:A.val()}),c.data("pivotUIOptions",j),w.autoSortUnusedAttrs&&(f=a.pivotUtilities.naturalSort,m=c.find("td.pvtUnused.pvtAxisContainer"),a(m).children("li").sort(function(b,c){return f(a(b).text(),a(c).text())}).appendTo(m)),x.css("opacity",1),null!=w.onRefresh?w.onRefresh(j):void 0}}(this),y=function(){return function(){return x.css("opacity",.5),setTimeout(z,10)}}(this),y(),this.find(".pvtAxisContainer").sortable({update:function(a,b){return null==b.sender?y():void 0},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder",receive:function(b){var c=b.originalEvent.originalEvent.path[1].id.split("_")[2],e=b.originalEvent.originalEvent.path[1].id.split("_")[0]+"_"+b.originalEvent.originalEvent.path[1].id.split("_")[1];if(b.target.id!=X+"_unused"){for(v in d.linkedAttributes)if(-1!=d.linkedAttributes[v].indexOf(c)){for(kk in d.linkedAttributes[v])internalTest=a("[id='"+e+"_"+d.linkedAttributes[v][kk]+"']"),internalTest.parent().get(0).id!=X+"_unused"&&a("#"+b.target.id).append(a(internalTest));break}}else a("#"+b.target.id).append(a("#axis_"+c))}}),this},a.fn.barchart=function(b){var c,d,e,f,g;for(f=a(b).data("numrows"),e=a(b).data("numcols"),c=function(b){return function(c){var d,e,f,g;return d=function(d){return b.find(c).each(function(){var b;return b=(""+a(this).data("value")).split(",")[0],null!=b&&isFinite(b)?d(b,a(this)):void 0})},g=[],d(function(a){return g.push(a)}),e=Math.max.apply(Math,g),f=function(a){return 100*a/(1.4*e)},d(function(b,c){var d,e;return d=c.text(),e=a("<div>").css({position:"relative",height:"55px"}),e.append(a("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:f(b)+"%","background-color":"gray"})),e.append(a("<div>").text(d).css({position:"relative","padding-left":"5px","padding-right":"5px"})),c.css({padding:0,"padding-top":"5px","text-align":"center"}).html(e)})}}(a(b)),d=g=0;f>=0?f>g:g>f;d=f>=0?++g:--g)c(".pvtVal.row"+d);return c(".pvtTotal.colTotal"),a(b)},a.fn.heatmap=function(b,c){var d,e,f,g,h,i,j,k;switch(null==c&&(c="heatmap"),i=a(b).data("numrows"),h=a(b).data("numcols"),d=function(a,b,c){var d;return d=function(){switch(a){case"red":return function(a){return"ff"+a+a};case"green":return function(a){return""+a+"ff"+a};case"blue":return function(a){return""+a+a+"ff"}}}(),function(a){var e,f;return f=255-Math.round(255*(a-b)/(c-b)),e=f.toString(16).split(".")[0],1===e.length&&(e=0+e),d(e)}},e=function(b){return function(c,e){var f,g,h;return g=function(d){return b.find(c).each(function(){var b;return b=(""+a(this).data("value")).split(",")[0],null!=b&&isFinite(b)?d(b,a(this)):void 0})},h=[],g(function(a){return h.push(a)}),f=d(e,Math.min.apply(Math,h),Math.max.apply(Math,h)),g(function(a,b){return b.css("background-color","#"+f(a))})}}(a(b)),c){case"heatmap":e(".pvtVal","red");break;case"rowheatmap":for(f=j=0;i>=0?i>j:j>i;f=i>=0?++j:--j)e(".pvtVal.row"+f,"red");break;case"colheatmap":for(g=k=0;h>=0?h>k:k>h;g=h>=0?++k:--k)e(".pvtVal.col"+g,"red")}return e(".pvtTotal.rowTotal","red"),e(".pvtTotal.colTotal","red"),a(b)},function(){return{render:C,destroy:v,changechkTreeview:w,exportExcel:x,exportCSV:B,showCode:y,showUnit:z,showFlags:A,originalData:q,myinputOpts:r}}});