function agregate_average(e){"use strict";var t={};return t.options=$.extend({},e),t.agregate=function(e,t){var i;if(i=e&&"agregate_average"===e.type?{type:"agregate_average",sum:e.sum,count:e.count}:{type:"agregate_average",sum:0,count:0},"agregate_average"===t.type)i.sum+=t.sum,i.count+=t.count;else if("object"==typeof t)if(i.count++,"number"==typeof t[this.options.field])i.sum+=t[this.options.field];else if("string"==typeof t[this.options.field])try{i.sum+=parseInt(t[this.options.field],10)}catch(s){}return i},t.getValue=function(e){var t=null;if(e&&"agregate_average"===e.type&&e.count>0){var i=e.sum/e.count;t=i}return t},t}function agregate_count(){"use strict";var e={};return e.agregate=function(e,t){var i;return i=e&&"agregate_count"===e.type?{type:"agregate_count",count:e.count}:{type:"agregate_count",count:0},"agregate_count"===t.type?i.count+=t.count:"object"==typeof t&&i.count++,i},e.getValue=function(e){var t=null;return e&&"agregate_count"===e.type&&(t=e.count),t},e}function agregate_distinct(e){"use strict";var t={};return t.field=e.field,t.agregate=function(e,t){var i={type:"fa_distinct"};return e&&"fa_distinct"===e.type?"fa_distinct"===t.type?(i.repeated=e.repeated||t.repeated||e.val!==t.val,i.val=e.val):"object"==typeof t&&("number"==typeof t[this.field]||"string"==typeof t[this.field])?(i.repeated=e.repeated||e.val!==t[this.field],i.val=e.val):(i.repeated=e.repeated||null!==e.val,i.val=null):(i.repeated=!1,"fa_distinct"===t.type?i.val=t.val:"object"==typeof t?(i.repeated=!1,i.val="number"==typeof t[this.field]||"string"==typeof t[this.field]?t[this.field]:null):i.val=null),i},t.getValue=function(e){var t=null;return e&&"fa_distinct"===e.type&&(t=e.repeated?"*":e.val),t},t}function agregate_sum(e){"use strict";var t={};return t.field=e.field,t.agregate=function(e,t){var i;if(i=e&&"agregate_sum"===e.type?{type:"agregate_sum",sum:e.sum}:{type:"agregate_sum",sum:0},"agregate_sum"===t.type)i.sum+=t.sum;else if("object"==typeof t)if("number"==typeof t[this.field])i.sum+=t[this.field];else if("string"==typeof t[this.field])try{i.sum+=parseInt(t[this.field],10)}catch(s){}return i},t.getValue=function(e){var t=null;return e&&"agregate_sum"===e.type&&(t=e.sum),t},t}function formatter_default(){"use strict";var e={};return e.format=function(e){var t="";try{t=e.toString()}catch(i){}return t},e}function grp_distinct(e){"use strict";var t={};return t.values=[],t.names={},t.fieldtype="number",t.field=e.field,t.sort="undefined"==typeof e.sort?"ASC":e.sort.toUpperCase(),t.params="undefined"!=typeof e.params?e.params:null,t.showAll="undefined"!=typeof e.showAll?e.showAll:!1,t.CalculateValue=function(e){var t,i="";return"function"==typeof e[this.field]?i=e[this.field](this.params):"number"==typeof e[this.field]?i=e[this.field].toString():"string"==typeof e[this.field]&&(i=e[this.field],this.fieldtype="string"),"string"!=typeof i&&(i=""),"undefined"!=typeof this.names[i]?t=this.names[i]:(t=this.values.push(i)-1,this.names[i]=t),t},t.getStringValue=function(e){return this.values[e]},t.DisplayValues=function(e){var t,i;if(this.showAll)for(t=[],i=0;i<this.values.length;i++)t.push(i.toString());else t=e.slice(0);var s=this;return t=t.sort("string"===this.fieldtype?function(e,t){var i=0;return s.values[e]<s.values[t]&&(i=-1),s.values[e]>s.values[t]&&(i=1),i}:function(e,t){var i=parseFloat(s.values[e]),l=parseFloat(s.values[t]),n=0;return l>i&&(n=-1),i>l&&(n=1),n}),"DESC"===this.sort&&(t=t.reverse()),t},t}$.unc={plugins:{agregates:{},addAgregate:function(e,t){"use strict";this.agregates[e]=t},groupers:{},addGrouper:function(e,t){"use strict";this.groupers[e]=t},formatters:{},addFormatter:function(e,t){"use strict";this.formatters[e]=t}}},$(function(){"use strict";$.widget("unc.jbPivot",{options:{fields:{},summary:!0,copyright:!0,formatter:"default",l_all:"All",l_unused_fields:"Unused fields"},_create:function(){this.CollapsedNodes={},this.renderPending=!1,this.reset(),"undefined"!=typeof this.options.data&&this.insertRecords(this.options.data);var e=this;$(this.element).on("click",".collapse_button",function(t){t.preventDefault(),e._togleCollapse(this.rel)}),$(this.element).on("dragstart",".draggable",function(t){e.pre_post="",e.dragcls="",e.dragdata=$(this).attr("rel"),t.originalEvent.dataTransfer.effectAllowed="move",t.originalEvent.dataTransfer.setData("Text",$(this).attr("rel")),$(".pivot").addClass("drag_in_progress")}),$(this.element).on("dragleave",".dropable",function(t){var i=$(this),s=i.attr("class").match(/\s+(target(X|Y|Z|U)[\d]+)($|\s)/),l="."+s[1],n=e.element;return setTimeout(function(){$(l,n).removeClass("dropping_pre"),$(l,n).removeClass("dropping_post"),e.pre_post="",e.dragcls=""},0),t.stopPropagation(),t.preventDefault(),!1}),$(this.element).on("dragover",".dropable",function(t){var i=$(this),s=$(this).offset(),l=t.originalEvent.pageX-s.left,n=t.originalEvent.pageY-s.top,r=i.attr("class").match(/\s+(target(X|Y|Z|U)([\d]+))($|\s)/);r[3]=parseInt(r[3],10);var a,h="."+r[1],o=e.pre_post,d=e.dragcls;a="Y"===r[2]||"U"===r[2]?n>i.height()/2?"post":"pre":l>i.width()/2?"post":"pre",0===r[3]&&(a="post");var f=e.dragdata,p=$(this).attr("rel");if(e._canMove(f,p,a)){var u=e.element;return(o!==a||h!==d)&&($(h,u).removeClass("dropping_pre"),$(h,u).removeClass("dropping_post"),setTimeout(function(){$(h,u).addClass("dropping_"+a),e.pre_post=a,e.dragcls=h},0)),t.originalEvent.dataTransfer.dropEffect="move",t.stopPropagation(),t.preventDefault(),!1}}),$(this.element).on("drop",".dropable",function(t){var i=$(this),s=$(this).offset(),l=t.originalEvent.pageX-s.left,n=t.originalEvent.pageY-s.top,r=i.attr("class").match(/\s+(target(X|Y|Z|U)([\d]+))($|\s)/);r[3]=parseInt(r[3],10);var a;a="Y"===r[2]||"U"===r[2]?n>i.height()/2?"post":"pre":l>i.width()/2?"post":"pre",0===r[3]&&(a="post");var h=t.originalEvent.dataTransfer.getData("Text"),o=$(this).attr("rel");return e._moveField(h,o,a),t.preventDefault(),!1}),$(this.element).on("dragend",".dropable",function(){var t=e.element;$(".pivot",t).removeClass("drag_in_progress")})},collapseAllButtton:function(){for(var e=0;e<$(this.options.InternalID+" .collapse_button").length;e++)$(this.options.InternalID).data("unc-jbPivot")._togleCollapse($(this.options.InternalID+" .collapse_button")[e].getAttribute("rel"))},reset:function(){if(this.fields=[],this.afields=[],this.xfields=[],this.yfields=[],this.zfields=[],this.ufields=[],this.fieldNames=[],this.fieldLabels=[],this.formatters=[],("undefined"==typeof this.options.formatter||null===this.options.formatter)&&(this.options.formatter="default"),"string"==typeof this.options.formatter){if("function"!=typeof $.unc.plugins.formatters[this.options.formatter])throw"Formatter: "+this.options.formatter+" is not defined";this.defaultFormatter=$.unc.plugins.formatters[this.options.formatter](this.options)}else{if("function"!=typeof this.options.formatter)throw"Invalid formatter";this.defaultFormatter={format:this.options.formatter}}if(null===this.options.formatter)throw"Formatter not defined";var e,t=0,i={};for(e in this.options.fields)if(this.options.fields.hasOwnProperty(e)){var s=$.extend({agregateType:"distinct",groupType:"distinct",label:e,formatter:null},this.options.fields[e]);if("none"!==s.groupType){if("function"!=typeof $.unc.plugins.groupers[s.groupType])throw"Grouper: "+s.groupType+" is not defined";this.fields.push($.unc.plugins.groupers[s.groupType](s))}else this.fields.push(null);if("none"!==s.agregateType){if("function"!=typeof $.unc.plugins.agregates[s.agregateType])throw"Grouper: "+s.agregateType+" is not defined";this.afields.push($.unc.plugins.agregates[s.agregateType](s))}else this.afields.push(null);if("string"==typeof s.formatter){if("function"!=typeof $.unc.plugins.formatters[s.formatter])throw"Formatter"+s.formatter+" is not defined";this.formatters.push($.unc.plugins.formatters[s.formatter](s))}else this.formatters.push("function"==typeof s.formatter?{format:s.formatter}:null);i[e]=t,t++,this.fieldNames.push(e),this.fieldLabels.push(s.label)}var l,n;for(l=0;l<this.options.xfields.length;l++){if(n=this.options.xfields[l],"undefined"==typeof i[n])throw"Field "+n+" in xfields not defined";if(null===typeof this.fields[i[n]])throw"Field "+n+"is not groupable ans is ispecified in xfields";this.xfields.push(i[n]),delete i[n]}for(l=0;l<this.options.yfields.length;l++){if(n=this.options.yfields[l],"undefined"==typeof i[n])throw"Field "+n+" in yfields not defined";if(null===typeof this.fields[i[n]])throw"Field "+n+"is not groupable ans is ispecified in yfields";this.yfields.push(i[n]),delete i[n]}for(l=0;l<this.options.zfields.length;l++){if(n=this.options.zfields[l],"undefined"==typeof i[n])throw"Field "+n+" in zfields not defined";if(null===typeof this.afields[i[n]])throw"Field "+n+"is not agregatable ans is ispecified in zfields";this.zfields.push(i[n]),delete i[n]}for(n in i)i.hasOwnProperty(n)&&this.ufields.push(i[n]);var r=(1<<this.fields.length)-1;this.indexes={},this.indexes_len={},this.indexes[r]={},this.indexes_len[r]=0,this._generate_trees(),this._forceRender()},insertRecords:function(e){var t,i;for(t=0;t<e.length;t++){var s=e[t],l=[];for(i=0;i<this.fields.length;i++)l.push(null!==this.fields[i]?this.fields[i].CalculateValue(s):0);for(var n in this.indexes)if(this.indexes.hasOwnProperty(n)){for(var r=l.slice(0),a=0;a<this.fields.length;a++)0===(1<<a&n)&&(r[a]=0);var h=this._arr2idx(r);for("undefined"==typeof this.indexes[n][h]&&(this.indexes[n][h]=[],this.indexes_len[n]++),i=0;i<this.afields.length;i++)null!==this.afields[i]&&(this.indexes[n][h][i]=this.afields[i].agregate(this.indexes[n][h][i],s))}}this._generate_trees(),this._forceRender()},_forceRender:function(){if(!this.renderPending){this.renderPending=!0;var e=this;setTimeout(function(){e.renderPending=!1,e._renderHtml()},100)}},_arr2idx:function(e){return e.join(",")},_idx2arr:function(e){var t,i=e.split(","),s=[];for(t=0;t<i.length;t++)s.push(parseInt(i[t],10));return s},_getValues:function(e){for(var t,i=0,s=0;s<this.fields.length;s++)-1===e[s]?e[s]=0:i|=1<<s;"undefined"==typeof this.indexes[i]&&this._generate_index(i),t=this._arr2idx(e);var l=this.indexes[i][t];return("undefined"==typeof l||null===l)&&(l=new Array(this.afields.length)),l},_generate_index:function(e){var t,i=null;for(t in this.indexes)(e&t)===e&&(null===i||this.indexes_len[t]<this.indexes_len[i])&&(i=t);this.indexes[e]={},this.indexes_len[e]=0;for(var s in this.indexes[i])if(this.indexes[i].hasOwnProperty(s)){var l=this._idx2arr(s);for(t=0;t<this.fields.length;t++)0===(1<<t&e)&&(l[t]=0);var n=this._arr2idx(l);"undefined"==typeof this.indexes[e][n]&&(this.indexes[e][n]=[],this.indexes_len[e]++);for(var r=0;r<this.afields.length;r++)null!==this.afields[r]&&(this.indexes[e][n][r]=this.afields[r].agregate(this.indexes[e][n][r],this.indexes[i][s][r]))}},_generate_trees:function(){var e,t,i=(1<<this.fields.length)-1;this.xtree={childs:{}},this.ytree={childs:{}};for(var s in this.indexes[i])if(this.indexes[i].hasOwnProperty(s)){var l=this._idx2arr(s);for(e=this.xtree,t=0;t<this.xfields.length;t++)"undefined"==typeof e.childs[l[this.xfields[t]]]&&(e.childs[l[this.xfields[t]]]={childs:{}}),e=e.childs[l[this.xfields[t]]];for(e=this.ytree,t=0;t<this.yfields.length;t++)"undefined"==typeof e.childs[l[this.yfields[t]]]&&(e.childs[l[this.yfields[t]]]={childs:{}}),e=e.childs[l[this.yfields[t]]]}},_tree2table:function(e,t,i){var s,l,n,r="y"===e?this.yfields.length:this.xfields.length;l=i.length-1,s=i[l].index.length;var a;if(this._isCollapsed(e,i[l].index))i[l].cells[s]={},i[l].cells[s].spanx=r-s+1,i[l].cells[s].spany=1,a=1;else{var h=i[l].index.slice(0),o=!1;a=0;var d;if(r>s){var f=[];for(n in t.childs)t.childs.hasOwnProperty(n)&&f.push(n);var p="y"===e?this.fields[this.yfields[s]]:this.fields[this.xfields[s]];d=p.DisplayValues(f)}else d=[];for(n=0;n<d.length;n++){o&&i.push({index:h.slice(0),cells:{}}),i[i.length-1].index.push(d[n]);var u;u="undefined"==typeof t.childs[d[n]]?{childs:{},collapsed:!1}:t.childs[d[n]],a+=this._tree2table(e,u,i),o=!0}0===a?(i[l].cells[s]={},i[l].cells[s].spanx=r-s+1,i[l].cells[s].spany=1,a=1):(i[l].cells[s]={},i[l].cells[s].spanx=1,i[l].cells[s].spany=a)}return a},_collapseLink:function(e,t){var i='<A href="#" class="collapse_button" rel="'+this._treeNode2str(e,t)+'">';return i+=this._isCollapsed(e,t)?"+":"-",i+="</A>"},_renderHtml:function(){var e,t,i,s,l,n,r,a=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length;a++;var h=[{index:[],cells:{}}];this._tree2table("x",this.xtree,h);var o=[{index:[],cells:{}}];this._tree2table("y",this.ytree,o);var d="";for(d+="<table border='0px' cellspacing='0' cellpadding='0' class='unused_fields'>",d+="<tr><th><button onclick=\"$('"+this.options.InternalID+"').data('unc-jbPivot').collapseAllButtton()\">Collapse all</button></th></tr>",d+="<tr><th class='unused_field dropable targetU0' rel='U,0'>"+this.options.l_unused_fields+"</th>",i=0;i<this.ufields.length;i++)d+="<tr><td draggable='true'",t="unused_field draggable dropable",t+=" targetU"+(i+1),d+=' class="'+t+'"',d+=" rel= 'U,"+(i+1)+"'",d+=">",d+=this.fieldLabels[this.ufields[i]],d+="</td></tr>";for(d+="</table>",d+='<table border="0px" cellspacing="0" cellpadding="0" class="pivot">',d+="<thead><tr>",d+='<th colspan="'+(this.xfields.length+1)+'" rowspan="'+(this.yfields.length+2)+'"',t="",t+=" line_bottom_"+a,t+=" line_right_"+a,d+=' class="'+t+'"',d+=">",d+="</th>",e=o.length*(this.zfields.length>0?this.zfields.length:1),d+="<th colspan="+e+'"',t="dropable toptitle targetY0 line_top_"+a,t+=" line_left_"+a,t+=" line_right_"+a,d+=' class="'+t+'"',d+=' rel="Y,0"',d+=">",this.yfields.length>0&&(d+=this._collapseLink("y",[])),d+=this.options.l_all,d+="</th>",d+="</tr>\n",l=1;l<=this.yfields.length;l++){for(d+="<tr>",s=0;s<o.length;s++)o[s].cells[l]&&(d+='<th draggable="true"',t="draggable dropable toptitle",t+=this._clsLeftLine(o,s,o[s].cells[l].spany),t+=this._clsRightLine(o,s,o[s].cells[l].spany),t+=" targetY"+l,d+=' class="'+t+'"',d+=' rel= "Y,'+l+'"',e=o[s].cells[l].spany*(this.zfields.length>0?this.zfields.length:1),d+=' colspan="'+e+'"',d+=' rowspan="'+o[s].cells[l].spanx+'"',d+=">",l<this.yfields.length&&(d+=this._collapseLink("y",o[s].index.slice(0,l))),d+=this.fields[this.yfields[l-1]].getStringValue(o[s].index[l-1]),d+="</th>");d+="</tr>\n"}for(d+="<tr>",s=0;s<o.length;s++){for(n=0;n<this.zfields.length;n++)d+='<th draggable="true"',t="draggable dropable ztitle",t+=" line_top_0",t+=" targetZ"+(n+1),t+=" line_top_"+a,t+=0===n?this._clsLeftLine(o,s):" line_left_0",t+=n===this.zfields.length-1?this._clsRightLine(o,s):" line_right_0",d+=' class="'+t+'"',d+=' rel= "Z,'+(n+1)+'"',d+=">",d+=this.fieldLabels[this.zfields[n]],d+="</th>";0===this.zfields.length&&(d+="<th",t="dropable ztitle",t+=" line_top_0",t+=" targetZ0",t+=" line_top_"+a,t+=this._clsLeftLine(o,s),t+=this._clsRightLine(o,s),d+=" class='"+t+"'",d+=" rel= 'Z,0'",d+=">",d+="&nbsp;",d+="</th>")}for(d+="</thead><tbody><tr>",l=0;l<h.length;l++){for(s=0;s<=this.xfields.length;s++)h[l].cells[s]&&(d+="<th",d+=h[l].cells[s].spanx>1?' colspan="'+h[l].cells[s].spanx+'"':"",d+=h[l].cells[s].spany>1?' rowspan="'+h[l].cells[s].spany+'"':"",t="lefttitle dropable",s>0&&(t+=" draggable"),0===s&&(t+=" line_left_"+a),t+=this._clsTopLine(h,l,h[l].cells[s].spany),t+=this._clsBottomLine(h,l,h[l].cells[s].spany),t+=" targetX"+s,d+=' class="'+t+'"',d+='"',d+=' rel="X,'+s+'"',s>0&&(d+=' draggable="true"'),d+=">",s<this.xfields.length&&(d+=this._collapseLink("x",h[l].index.slice(0,s))),d+=0===s?this.options.l_all:this.fields[this.xfields[s-1]].getStringValue(h[l].index[s-1]),d+="</th>");for(s=0;s<o.length;s++){for(r=[],i=0;i<this.fields.length;i++)r.push(-1);for(i=0;i<h[l].index.length;i++)r[this.xfields[i]]=h[l].index[i];for(i=0;i<o[s].index.length;i++)r[this.yfields[i]]=o[s].index[i];for(f=this._getValues(r),n=0;n<this.zfields.length;n++)d+="<td",t="",t+=this._clsTopLine(h,l),t+=this._clsBottomLine(h,l),t+=0===n?this._clsLeftLine(o,s):" line_left_0",t+=n===this.zfields.length-1?this._clsRightLine(o,s):" line_right_0",d+=' class="'+t+'"',d+=">",d+=this._format(this.afields[this.zfields[n]].getValue(f[this.zfields[n]]),this.zfields[n]),d+="</td>";0===this.zfields.length&&(d+="<td",t="",t+=this._clsTopLine(h,l),t+=this._clsBottomLine(h,l),t+=this._clsLeftLine(o,s),t+=this._clsRightLine(o,s),d+=" class='"+t+"'",d+=">",d+="&nbsp;",d+="</td>")}d+="</tr>"}if(this.options.summary&&this.zfields.length>0){for(d+="<tr>",d+="<td colspan='"+(this.xfields.length+1)+"'",d+=" >",d+="</td>",s=0;s<o.length;s++){for(r=[],i=0;i<this.fields.length;i++)r.push(-1);for(i=0;i<o[s].index.length;i++)r[this.yfields[i]]=o[s].index[i];var f=this._getValues(r);for(n=0;n<this.zfields.length;n++)d+="<td",t="summary",t+=" line_top_"+a,t+=" line_bottom_"+a,t+=0===n?this._clsLeftLine(o,s):" line_left_0",t+=n===this.zfields.length-1?this._clsRightLine(o,s):" line_right_0",d+=' class="'+t+'"',d+=">",d+=this._format(this.afields[this.zfields[n]].getValue(f[this.zfields[n]]),this.zfields[n]),d+="</td>"}d+="</tr>"}var p=1+this.xfields.length+o.length*this.zfields.length;for(d+="<tr><td colspan='"+p,t="",t+=" line_right_"+a,t+=" line_left_"+a,t+=" line_top_"+a,d+=" class='"+t+"'",d+=">",d+="<tr>",i=0;p>i;i++)d+="<td ",t="bordermark",d+=" class='"+t+"'",d+=">",d+="</td>";d+="</tr></tbody>",this.options.copyright&&(d+="<tr><td colspan='"+p+"'",t="copyright",d+=" class='"+t+"'",d+=">",d+="<a href='http://www.jbPivot.org'>jbPivot</a> by <a href='http://www.uniclau.org'> Uniclau S.L. &copy; 2013 </a> <a href='http://www.gnu.org/licenses/gpl.html'><img src='http://www.gnu.org/graphics/gplv3-88x31.png'></a>",d+="</tr>"),d+="</table>",this.element[0].innerHTML=d},_treeNode2str:function(e,t){var i,s=[];if(0===t.length)return e;for(i=0;i<this.fields.length;i++)s.push(-1);for(i=0;i<t.length;i++)"y"===e?s[this.yfields[i]]=t[i]:s[this.xfields[i]]=t[i];return s.join(",")},_isCollapsed:function(e,t){var i=this._treeNode2str(e,t);return"undefined"!=typeof this.CollapsedNodes[i]},_togleCollapse:function(e){"undefined"==typeof this.CollapsedNodes[e]?this.CollapsedNodes[e]=!0:delete this.CollapsedNodes[e],this._forceRender()},_canMove:function(e,t,i){var s=e.split(",");s[1]=parseInt(s[1],10);var l=t.split(",");l[1]=parseInt(l[1],10),"pre"===i&&l[1]--,s[1]--;var n=!1;return"Z"===l[0]?"X"===s[0]?n=null!==this.afields[this.xfields[s[1]]]:"Y"===s[0]?n=null!==this.afields[this.yfields[s[1]]]:"Z"===s[0]?n=null!==this.afields[this.zfields[s[1]]]:"U"===s[0]&&(n=null!==this.afields[this.ufields[s[1]]]):"X"===l[0]||"Y"===l[0]?"X"===s[0]?n=null!==this.fields[this.xfields[s[1]]]:"Y"===s[0]?n=null!==this.fields[this.yfields[s[1]]]:"Z"===s[0]?n=null!==this.fields[this.zfields[s[1]]]:"U"===s[0]&&(n=null!==this.fields[this.ufields[s[1]]]):"U"===l[0]&&(n=!0),n},_moveField:function(e,t,i){var s=e.split(",");s[1]=parseInt(s[1],10);var l=t.split(",");l[1]=parseInt(l[1],10),"pre"===i&&l[1]--;var n=-1;if("X"===s[0]?(n=this.xfields[s[1]-1],this.xfields.splice(s[1]-1,1)):"Y"===s[0]?(n=this.yfields[s[1]-1],this.yfields.splice(s[1]-1,1)):"Z"===s[0]?(n=this.zfields[s[1]-1],this.zfields.splice(s[1]-1,1)):"U"===s[0]&&(n=this.ufields[s[1]-1],this.ufields.splice(s[1]-1,1)),-1===n)throw"Assert: "+s[0]+" is an invalid axis";s[0]===l[0]&&s[1]<l[1]&&l[1]--,"X"===l[0]?this.xfields.splice(l[1],0,n):"Y"===l[0]?this.yfields.splice(l[1],0,n):"Z"===l[0]?this.zfields.splice(l[1],0,n):"U"===l[0]&&this.ufields.splice(l[1],0,n),this._generate_trees(),this._forceRender()},_clsLeftLine:function(e,t,i){"undefined"==typeof i&&(i=1);var s,l=" ";if(t>0){for(s=0;s<this.yfields.length&&s<e[t].index.length&&s<e[t-1].index.length&&e[t].index[s]===e[t-1].index[s];)s++;s=this.yfields.length-s}else s=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length,s++;return l+=" line_left_"+s},_clsRightLine:function(e,t,i){"undefined"==typeof i&&(i=1);var s,l=" ";if(t+i<e.length){for(s=0;s<this.yfields.length&&s<e[t].index.length&&s<e[t+i].index.length&&e[t].index[s]===e[t+i].index[s];)s++;s=this.yfields.length-s}else s=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length,s++;return l+=" line_right_"+s},_clsTopLine:function(e,t,i){"undefined"==typeof i&&(i=1);var s,l=" ";if(t>0){for(s=0;s<this.xfields.length&&s<e[t].index.length&&s<e[t-1].index.length&&e[t].index[s]===e[t-1].index[s];)s++;s=this.xfields.length-s}else s=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length,s++;return l+=" line_top_"+s},_clsBottomLine:function(e,t,i){"undefined"==typeof i&&(i=1);var s,l=" ";if(t+i<e.length){for(s=0;s<this.xfields.length&&s<e[t].index.length&&s<e[t+i].index.length&&e[t].index[s]===e[t+i].index[s];)s++;s=this.xfields.length-s}else s=this.xfields.length>this.yfields.length?this.xfields.length:this.yfields.length,s++;return l+=" line_bottom_"+s},_format:function(e,t){var i=null;return null!==this.formatters[t]&&(i=this.formatters[t].format(e,this.fieldNames[t])),("undefined"==typeof i||null===i)&&(i=this.defaultFormatter.format(e,this.fieldNames[t])),i}})}),$.unc.plugins.addAgregate("average",agregate_average),$.unc.plugins.addAgregate("count",agregate_count),$.unc.plugins.addAgregate("distinct",agregate_distinct),$.unc.plugins.addAgregate("sum",agregate_sum),$.unc.plugins.addFormatter("default",formatter_default),$.unc.plugins.addGrouper("distinct",grp_distinct);